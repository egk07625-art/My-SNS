# ν”λ΅μ° κΈ°λ¥ κµ¬ν„ κ³„νμ„

## π“‹ κ°μ”

PRD λ¬Έμ„μ 3-3 μ„Ήμ…μ— λ…μ‹λ ν”λ΅μ° κΈ°λ¥μ„ κµ¬ν„ν•©λ‹λ‹¤.
- **λ©ν‘**: μ‚¬μ©μ κ°„ ν”λ΅μ°/μ–Έν”λ΅μ° κΈ°λ¥ κµ¬ν„
- **κΈ°μ¤€**: PRD 490-494 λΌμΈ, 7.6 μ„Ήμ… (301-307 λΌμΈ)
- **μ›μΉ™**: μ•μ •μ„±, ν™•μ¥μ„±, λ¨λ“ν™” μµμ°μ„ 

---

## π― μ”κµ¬μ‚¬ν•­ λ¶„μ„

### PRD λ…μ„Έ
1. **follows ν…μ΄λΈ” μƒμ„±** (μ΄λ―Έ μ™„λ£λ¨ β…)
2. **/api/follows POST/DELETE API**
3. **ν”λ΅μ°/μ–Έν”λ΅μ° λ²„νΌ λ° μƒνƒ κ΄€λ¦¬**

### UI/UX μ”κµ¬μ‚¬ν•­ (PRD 7.6)
- **λ²„νΌ μƒνƒ**:
  - λ―Έν”λ΅μ°: "ν”λ΅μ°" (νλ€μƒ‰ `#0095f6`)
  - ν”λ΅μ° μ¤‘: "ν”λ΅μ‰" (νμƒ‰)
- **Hover ν¨κ³Ό**: "μ–Έν”λ΅μ°" (λΉ¨κ°„ ν…λ‘λ¦¬)
- **ν΄λ¦­ λ™μ‘**: μ¦‰μ‹ API νΈμ¶ β†’ UI μ—…λ°μ΄νΈ

### λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ (μ΄λ―Έ μ΅΄μ¬)
```sql
-- follows ν…μ΄λΈ” κµ¬μ΅°
CREATE TABLE public.follows (
    id UUID PRIMARY KEY,
    follower_id UUID NOT NULL,  -- ν”λ΅μ°ν•λ” μ‚¬λ
    following_id UUID NOT NULL,  -- ν”λ΅μ°λ°›λ” μ‚¬λ
    created_at TIMESTAMPTZ DEFAULT now(),
    UNIQUE(follower_id, following_id),
    CHECK (follower_id != following_id)
);
```

---

## π—οΈ μ•„ν‚¤ν…μ² μ„¤κ³„

### 1. λ μ΄μ–΄ κµ¬μ΅°

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  UI Layer (Client Components)           β”‚
β”‚  - FollowButton.tsx                     β”‚
β”‚  - ProfileHeader.tsx (ν”λ΅μ° λ²„νΌ ν¬ν•¨)  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                  β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  Business Logic Layer                   β”‚
β”‚  - hooks/use-follow.ts (ν”λ΅μ° μƒνƒ κ΄€λ¦¬)β”‚
β”‚  - lib/api/follows.ts (API ν΄λΌμ΄μ–ΈνΈ)   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                  β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  API Layer (Server Routes)              β”‚
β”‚  - app/api/follows/route.ts             β”‚
β”‚    - POST: ν”λ΅μ° μƒμ„±                  β”‚
β”‚    - DELETE: ν”λ΅μ° μ‚­μ                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                  β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  Data Layer (Supabase)                  β”‚
β”‚  - follows ν…μ΄λΈ”                       β”‚
β”‚  - user_stats λ·° (ν”λ΅μ›/ν”λ΅μ‰ μ)     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 2. λ¨λ“ν™” μ „λµ

#### 2.1 API ν΄λΌμ΄μ–ΈνΈ λ¨λ“ (`lib/api/follows.ts`)
- **λ©μ **: API νΈμ¶ λ΅μ§ μΊ΅μν™”
- **μ±…μ„**:
  - ν”λ΅μ°/μ–Έν”λ΅μ° API νΈμ¶
  - μ—λ¬ μ²λ¦¬ λ° νƒ€μ… μ•μ •μ„±
  - μ¬μ‚¬μ© κ°€λ¥ν• ν•¨μ μ κ³µ

#### 2.2 μ»¤μ¤ν…€ ν›… (`hooks/use-follow.ts`)
- **λ©μ **: ν”λ΅μ° μƒνƒ κ΄€λ¦¬ λ° UI λ΅μ§
- **μ±…μ„**:
  - ν”λ΅μ° μƒνƒ (isFollowing) κ΄€λ¦¬
  - λ΅λ”© μƒνƒ κ΄€λ¦¬
  - μ—λ¬ μƒνƒ κ΄€λ¦¬
  - ν”λ΅μ› μ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ
  - Optimistic UI μ—…λ°μ΄νΈ

#### 2.3 UI μ»΄ν¬λ„νΈ (`components/profile/follow-button.tsx`)
- **λ©μ **: ν”λ΅μ° λ²„νΌ UI μ»΄ν¬λ„νΈ
- **μ±…μ„**:
  - λ²„νΌ λ λ”λ§ (ν”λ΅μ°/ν”λ΅μ‰ μƒνƒ)
  - Hover ν¨κ³Ό (μ–Έν”λ΅μ°)
  - ν΄λ¦­ μ΄λ²¤νΈ μ²λ¦¬
  - λ΅λ”© μƒνƒ ν‘μ‹

---

## π“ μƒμ„Έ κµ¬ν„ κ³„ν

### Phase 1: νƒ€μ… μ •μ λ° API μ‘λ‹µ νƒ€μ… μ¶”κ°€

#### 1.1 νƒ€μ… μ •μ (`lib/types.ts`)
- β… `Follow` μΈν„°νμ΄μ¤ (μ΄λ―Έ μ΅΄μ¬)
- μ¶”κ°€ν•  νƒ€μ…:
  ```typescript
  // ν”λ΅μ° μƒνƒλ¥Ό ν¬ν•¨ν• μ‚¬μ©μ μ •λ³΄
  export interface UserWithFollowStatus extends User {
    is_following?: boolean; // ν„μ¬ μ‚¬μ©μκ°€ μ΄ μ‚¬μ©μλ¥Ό ν”λ΅μ°ν•λ”μ§€
    followers_count?: number;
    following_count?: number;
  }

  // ν”λ΅μ° API μ‘λ‹µ
  export interface FollowResponse {
    success: boolean;
    follow?: Follow;
    message?: string;
  }

  // ν”λ΅μ° μƒνƒ μ΅°ν μ‘λ‹µ
  export interface FollowStatusResponse {
    is_following: boolean;
    followers_count: number;
    following_count: number;
  }
  ```

#### 1.2 μ—λ¬ νƒ€μ… μ •μ
```typescript
export class FollowError extends Error {
  constructor(
    message: string,
    public code: 'ALREADY_FOLLOWING' | 'NOT_FOLLOWING' | 'CANNOT_FOLLOW_SELF' | 'USER_NOT_FOUND' | 'UNAUTHORIZED' | 'UNKNOWN'
  ) {
    super(message);
    this.name = 'FollowError';
  }
}
```

---

### Phase 2: API λΌμ°νΈ κµ¬ν„ (`app/api/follows/route.ts`)

#### 2.1 POST /api/follows (ν”λ΅μ°)

**μ”μ²­ νλΌλ―Έν„°:**
```typescript
{
  following_id: string; // ν”λ΅μ°ν•  μ‚¬μ©μ ID (UUID)
}
```

**κµ¬ν„ λ΅μ§:**
1. **μΈμ¦ ν™•μΈ**
   - Clerk `auth()` μ‚¬μ©
   - λ―ΈμΈμ¦ μ‹ 401 λ°ν™

2. **μ”μ²­ κ²€μ¦**
   - `following_id` ν•„μ μ—¬λ¶€ ν™•μΈ
   - UUID ν•μ‹ κ²€μ¦
   - μκΈ° μμ‹  ν”λ΅μ° λ°©μ§€ (DB CHECK μ μ•½μ΅°κ±΄μΌλ΅λ„ λ°©μ§€)

3. **μ‚¬μ©μ μ΅΄μ¬ ν™•μΈ**
   - `following_id`λ΅ users ν…μ΄λΈ” μ΅°ν
   - μ΅΄μ¬ν•μ§€ μ•μΌλ©΄ 404 λ°ν™

4. **μ¤‘λ³µ ν”λ΅μ° ν™•μΈ**
   - `follows` ν…μ΄λΈ”μ—μ„ `(follower_id, following_id)` μ΅°ν
   - μ΄λ―Έ ν”λ΅μ° μ¤‘μ΄λ©΄ 409 Conflict λ°ν™

5. **ν”λ΅μ° μƒμ„±**
   - `follows` ν…μ΄λΈ”μ— INSERT
   - νΈλμ­μ… κ³ λ ¤ (ν„μ¬λ” λ‹¨μΌ INSERTμ΄λ―€λ΅ λ¶ν•„μ”)

6. **μ‘λ‹µ λ°ν™**
   - μ„±κ³µ: 201 Created + `Follow` κ°μ²΄
   - μ‹¤ν¨: μ μ ν• HTTP μƒνƒ μ½”λ“ + μ—λ¬ λ©”μ‹μ§€

**μ—λ¬ μ²λ¦¬:**
- `UNIQUE` μ μ•½μ΅°κ±΄ μ„λ° β†’ 409 Conflict
- `CHECK` μ μ•½μ΅°κ±΄ μ„λ° (μκΈ° μμ‹ ) β†’ 400 Bad Request
- μ™Έλν‚¤ μ μ•½μ΅°κ±΄ μ„λ° β†’ 404 Not Found
- κΈ°νƒ€ DB μ—λ¬ β†’ 500 Internal Server Error

**λ΅κ·Έ:**
- μ”μ²­ μ‹μ‘: `console.group("[API] POST /api/follows")`
- μΈμ¦ ν™•μΈ: `console.log("User authenticated:", userId)`
- κ²€μ¦: `console.log("Validating request:", { following_id })`
- DB μ΅°ν/μƒμ„±: `console.log("Follow created:", followId)`
- μ—λ¬: `console.error("Error:", error)`

#### 2.2 DELETE /api/follows (μ–Έν”λ΅μ°)

**μ”μ²­ νλΌλ―Έν„°:**
```typescript
{
  following_id: string; // μ–Έν”λ΅μ°ν•  μ‚¬μ©μ ID (UUID)
}
```

**κµ¬ν„ λ΅μ§:**
1. **μΈμ¦ ν™•μΈ** (POSTμ™€ λ™μΌ)

2. **μ”μ²­ κ²€μ¦**
   - `following_id` ν•„μ μ—¬λ¶€ ν™•μΈ
   - UUID ν•μ‹ κ²€μ¦

3. **ν”λ΅μ° κ΄€κ³„ ν™•μΈ**
   - `follows` ν…μ΄λΈ”μ—μ„ `(follower_id, following_id)` μ΅°ν
   - μ΅΄μ¬ν•μ§€ μ•μΌλ©΄ 404 Not Found λ°ν™

4. **μ–Έν”λ΅μ° μ‹¤ν–‰**
   - `follows` ν…μ΄λΈ”μ—μ„ DELETE

5. **μ‘λ‹µ λ°ν™**
   - μ„±κ³µ: 200 OK
   - μ‹¤ν¨: μ μ ν• HTTP μƒνƒ μ½”λ“

**μ—λ¬ μ²λ¦¬:**
- ν”λ΅μ° κ΄€κ³„ μ—†μ β†’ 404 Not Found
- κΈ°νƒ€ DB μ—λ¬ β†’ 500 Internal Server Error

#### 2.3 GET /api/follows/status?userId={userId} (μ„ νƒμ )

**λ©μ **: νΉμ • μ‚¬μ©μμ— λ€ν• ν”λ΅μ° μƒνƒ μ΅°ν

**κµ¬ν„ λ΅μ§:**
1. μΈμ¦ ν™•μΈ
2. `userId` μΏΌλ¦¬ νλΌλ―Έν„° ν™•μΈ
3. `follows` ν…μ΄λΈ” μ΅°ν
4. `user_stats` λ·°μ—μ„ ν”λ΅μ›/ν”λ΅μ‰ μ μ΅°ν
5. μ‘λ‹µ λ°ν™

**μ°Έκ³ **: μ΄ APIλ” Phase 3μ—μ„ ν”„λ΅ν•„ νμ΄μ§€ λ΅λ“ μ‹ μ‚¬μ© κ°€λ¥

---

### Phase 3: API ν΄λΌμ΄μ–ΈνΈ λ¨λ“ (`lib/api/follows.ts`)

**λ©μ **: ν΄λΌμ΄μ–ΈνΈμ—μ„ API νΈμ¶μ„ μ‰½κ² ν•κΈ° μ„ν• μ ν‹Έλ¦¬ν‹° ν•¨μ

**κµ¬ν„ ν•¨μ:**

```typescript
/**
 * ν”λ΅μ° μƒμ„±
 */
export async function followUser(followingId: string): Promise<FollowResponse>

/**
 * μ–Έν”λ΅μ°
 */
export async function unfollowUser(followingId: string): Promise<FollowResponse>

/**
 * ν”λ΅μ° μƒνƒ μ΅°ν
 */
export async function getFollowStatus(userId: string): Promise<FollowStatusResponse>
```

**νΉμ§•:**
- νƒ€μ… μ•μ •μ„± λ³΄μ¥
- μ—λ¬ μ²λ¦¬ ν†µμΌ
- μ¬μ‚¬μ© κ°€λ¥
- ν…μ¤νΈ μ©μ΄

**μ—λ¬ μ²λ¦¬:**
- λ„¤νΈμ›ν¬ μ—λ¬ β†’ `FollowError`λ΅ λ³€ν™
- API μ—λ¬ μ‘λ‹µ β†’ μ μ ν• μ—λ¬ λ©”μ‹μ§€ μ¶”μ¶
- μ‚¬μ©μ μΉν™”μ  μ—λ¬ λ©”μ‹μ§€

---

### Phase 4: μ»¤μ¤ν…€ ν›… (`hooks/use-follow.ts`)

**λ©μ **: ν”λ΅μ° μƒνƒ κ΄€λ¦¬ λ° UI λ΅μ§ μΊ΅μν™”

**μΈν„°νμ΄μ¤:**
```typescript
interface UseFollowOptions {
  userId: string; // ν”λ΅μ°ν• /μ–Έν”λ΅μ°ν•  μ‚¬μ©μ ID
  initialIsFollowing?: boolean; // μ΄κΈ° ν”λ΅μ° μƒνƒ
  initialFollowersCount?: number; // μ΄κΈ° ν”λ΅μ› μ
  onSuccess?: () => void; // μ„±κ³µ μ½λ°±
  onError?: (error: Error) => void; // μ—λ¬ μ½λ°±
}

interface UseFollowReturn {
  isFollowing: boolean; // ν„μ¬ ν”λ΅μ° μƒνƒ
  isLoading: boolean; // λ΅λ”© μƒνƒ
  error: Error | null; // μ—λ¬ μƒνƒ
  followersCount: number; // ν”λ΅μ› μ
  toggleFollow: () => Promise<void>; // ν”λ΅μ°/μ–Έν”λ΅μ° ν† κΈ€
}
```

**κµ¬ν„ λ΅μ§:**
1. **μƒνƒ κ΄€λ¦¬**
   - `isFollowing`: ν”λ΅μ° μƒνƒ (λ΅μ»¬ μƒνƒ)
   - `isLoading`: λ΅λ”© μƒνƒ
   - `error`: μ—λ¬ μƒνƒ
   - `followersCount`: ν”λ΅μ› μ

2. **Optimistic UI μ—…λ°μ΄νΈ**
   - API νΈμ¶ μ „ UI λ¨Όμ € μ—…λ°μ΄νΈ
   - μ‹¤ν¨ μ‹ λ΅¤λ°±

3. **μ—λ¬ μ²λ¦¬**
   - μ—λ¬ λ°μƒ μ‹ μ‚¬μ©μμ—κ² μ•λ¦Ό
   - Optimistic μ—…λ°μ΄νΈ λ΅¤λ°±

4. **μ¬μ‹λ„ λ΅μ§** (μ„ νƒμ )
   - μ‹¤ν¨ μ‹ μλ™ μ¬μ‹λ„ (μµλ€ 3ν)

**μμ™Έ μ²λ¦¬:**
- λ„¤νΈμ›ν¬ μ—λ¬
- μ¤‘λ³µ ν”λ΅μ°/μ–Έν”λ΅μ°
- κ¶ν• μ—λ¬
- μ‚¬μ©μ μ—†μ

---

### Phase 5: UI μ»΄ν¬λ„νΈ (`components/profile/follow-button.tsx`)

**λ©μ **: ν”λ΅μ°/μ–Έν”λ΅μ° λ²„νΌ UI

**Props:**
```typescript
interface FollowButtonProps {
  userId: string; // ν”λ΅μ°ν•  μ‚¬μ©μ ID
  initialIsFollowing?: boolean;
  initialFollowersCount?: number;
  className?: string;
  variant?: 'default' | 'compact'; // λ²„νΌ ν¬κΈ° λ³€ν•
}
```

**UI μƒνƒ:**
1. **λ―Έν”λ΅μ° μƒνƒ**
   - ν…μ¤νΈ: "ν”λ΅μ°"
   - λ°°κ²½: νλ€μƒ‰ `#0095f6`
   - ν…μ¤νΈ: ν°μƒ‰

2. **ν”λ΅μ° μ¤‘ μƒνƒ**
   - ν…μ¤νΈ: "ν”λ΅μ‰"
   - λ°°κ²½: ν°μƒ‰
   - ν…λ‘λ¦¬: νμƒ‰ `#DBDBDB`
   - ν…μ¤νΈ: `#262626`

3. **Hover μƒνƒ (ν”λ΅μ° μ¤‘μΌ λ•)**
   - ν…μ¤νΈ: "μ–Έν”λ΅μ°"
   - ν…λ‘λ¦¬: λΉ¨κ°„μƒ‰ `#ed4956`
   - ν…μ¤νΈ: λΉ¨κ°„μƒ‰

4. **λ΅λ”© μƒνƒ**
   - λ²„νΌ λΉ„ν™μ„±ν™”
   - μ¤ν”Όλ„ ν‘μ‹

5. **μ—λ¬ μƒνƒ**
   - μ—λ¬ ν† μ¤νΈ ν‘μ‹ (μ„ νƒμ )
   - λ²„νΌ μƒνƒ μ μ§€

**μ• λ‹λ©”μ΄μ…:**
- ν΄λ¦­ μ‹ μ•½κ°„μ scale ν¨κ³Ό (μ„ νƒμ )
- μƒνƒ μ „ν™ μ‹ λ¶€λ“λ¬μ΄ transition

**μ ‘κ·Όμ„±:**
- `aria-label` μ†μ„± μ¶”κ°€
- ν‚¤λ³΄λ“ μ ‘κ·Ό κ°€λ¥
- λ΅λ”© μƒνƒ `aria-busy` μ‚¬μ©

---

### Phase 6: ν”„λ΅ν•„ νμ΄μ§€ ν†µν•©

#### 6.1 ν”„λ΅ν•„ ν—¤λ” μ»΄ν¬λ„νΈ μμ •
- `components/profile/profile-header.tsx`μ— `FollowButton` ν†µν•©
- ν”λ΅μ›/ν”λ΅μ‰ μ ν‘μ‹
- μμ‹ μ ν”„λ΅ν•„μΈ κ²½μ° λ²„νΌ μ¨κΉ€

#### 6.2 ν”„λ΅ν•„ νμ΄μ§€ API μμ •
- `/api/users/[userId]`μ— ν”λ΅μ° μƒνƒ ν¬ν•¨
- `user_stats` λ·° ν™μ©

---

## π”’ λ³΄μ• κ³ λ ¤μ‚¬ν•­

### 1. μΈμ¦ κ²€μ¦
- λ¨λ“  API μ—”λ“ν¬μΈνΈμ—μ„ Clerk μΈμ¦ ν™•μΈ
- λ―ΈμΈμ¦ μ”μ²­ β†’ 401 λ°ν™

### 2. κ¶ν• κ²€μ¦
- μκΈ° μμ‹  ν”λ΅μ° λ°©μ§€ (DB CHECK + API κ²€μ¦)
- μ΅΄μ¬ν•μ§€ μ•λ” μ‚¬μ©μ ν”λ΅μ° λ°©μ§€

### 3. μ…λ ¥ κ²€μ¦
- UUID ν•μ‹ κ²€μ¦
- SQL Injection λ°©μ§€ (Supabase ORM μ‚¬μ©)

### 4. Rate Limiting (μ¶”ν›„ ν™•μ¥)
- λ™μΌ μ‚¬μ©μμ κ³Όλ„ν• ν”λ΅μ°/μ–Έν”λ΅μ° λ°©μ§€
- ν„μ¬λ” λ―Έκµ¬ν„, μ¶”ν›„ μ¶”κ°€ κ³ λ ¤

---

## π§ ν…μ¤νΈ μ „λµ

### 1. λ‹¨μ„ ν…μ¤νΈ
- API ν΄λΌμ΄μ–ΈνΈ ν•¨μ (`lib/api/follows.ts`)
- μ»¤μ¤ν…€ ν›… (`hooks/use-follow.ts`)

### 2. ν†µν•© ν…μ¤νΈ
- API λΌμ°νΈ (`app/api/follows/route.ts`)
- DB μ΅°μ‘ μ •ν™•μ„±

### 3. E2E ν…μ¤νΈ (μ„ νƒμ )
- ν”λ΅μ°/μ–Έν”λ΅μ° ν”λ΅μ°
- μ—λ¬ μ²λ¦¬

### 4. μλ™ ν…μ¤νΈ μ²΄ν¬λ¦¬μ¤νΈ
- [ ] μ •μƒ ν”λ΅μ°
- [ ] μ •μƒ μ–Έν”λ΅μ°
- [ ] μκΈ° μμ‹  ν”λ΅μ° μ‹λ„ (μ—λ¬)
- [ ] μ¤‘λ³µ ν”λ΅μ° μ‹λ„ (μ—λ¬)
- [ ] μ΅΄μ¬ν•μ§€ μ•λ” μ‚¬μ©μ ν”λ΅μ° (μ—λ¬)
- [ ] λ„¤νΈμ›ν¬ μ—λ¬ μ²λ¦¬
- [ ] λ΅λ”© μƒνƒ ν‘μ‹
- [ ] Optimistic UI μ—…λ°μ΄νΈ
- [ ] ν”λ΅μ› μ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ

---

## π“ μ„±λ¥ μµμ ν™”

### 1. λ°μ΄ν„°λ² μ΄μ¤
- β… μΈλ±μ¤: `idx_follows_follower_id`, `idx_follows_following_id` (μ΄λ―Έ μ΅΄μ¬)
- β… UNIQUE μ μ•½μ΅°κ±΄μΌλ΅ μ¤‘λ³µ λ°©μ§€
- `user_stats` λ·° ν™μ©μΌλ΅ ν”λ΅μ›/ν”λ΅μ‰ μ μ΅°ν μµμ ν™”

### 2. API μµμ ν™”
- ν•„μ”ν• λ°μ΄ν„°λ§ μ΅°ν
- λ¶ν•„μ”ν• JOIN μµμ†ν™”

### 3. ν΄λΌμ΄μ–ΈνΈ μµμ ν™”
- Optimistic UI μ—…λ°μ΄νΈλ΅ μ¦‰κ°μ μΈ ν”Όλ“λ°±
- React Query λλ” SWR μ‚¬μ© κ³ λ ¤ (ν„μ¬λ” λ―Έμ‚¬μ©)

---

## π¨ μ—λ¬ μ²λ¦¬ μ „λµ

### 1. API λ λ²¨
- λ…ν™•ν• HTTP μƒνƒ μ½”λ“ μ‚¬μ©
- μ‚¬μ©μ μΉν™”μ  μ—λ¬ λ©”μ‹μ§€
- μƒμ„Έν• λ΅κ·Έ κΈ°λ΅

### 2. ν΄λΌμ΄μ–ΈνΈ λ λ²¨
- μ—λ¬ μƒνƒ κ΄€λ¦¬
- μ‚¬μ©μμ—κ² μ—λ¬ μ•λ¦Ό
- Optimistic μ—…λ°μ΄νΈ λ΅¤λ°±

### 3. μ—λ¬ λ©”μ‹μ§€ λ§¤ν•‘
```typescript
const ERROR_MESSAGES = {
  'ALREADY_FOLLOWING': 'μ΄λ―Έ ν”λ΅μ° μ¤‘μΈ μ‚¬μ©μμ…λ‹λ‹¤.',
  'NOT_FOLLOWING': 'ν”λ΅μ°ν•μ§€ μ•μ€ μ‚¬μ©μμ…λ‹λ‹¤.',
  'CANNOT_FOLLOW_SELF': 'μκΈ° μμ‹ μ€ ν”λ΅μ°ν•  μ μ—†μµλ‹λ‹¤.',
  'USER_NOT_FOUND': 'μ‚¬μ©μλ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤.',
  'UNAUTHORIZED': 'λ΅κ·ΈμΈμ΄ ν•„μ”ν•©λ‹λ‹¤.',
  'NETWORK_ERROR': 'λ„¤νΈμ›ν¬ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.',
  'UNKNOWN': 'μ• μ μ—†λ” μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.',
};
```

---

## π“¦ νμΌ κµ¬μ΅°

```
app/
β”β”€β”€ api/
β”‚   β””β”€β”€ follows/
β”‚       β””β”€β”€ route.ts              # POST, DELETE ν•Έλ“¤λ¬
β”‚
components/
β”β”€β”€ profile/
β”‚   β”β”€β”€ follow-button.tsx         # ν”λ΅μ° λ²„νΌ μ»΄ν¬λ„νΈ
β”‚   β””β”€β”€ profile-header.tsx        # ν”„λ΅ν•„ ν—¤λ” (ν”λ΅μ° λ²„νΌ ν†µν•©)
β”‚
hooks/
β””β”€β”€ use-follow.ts                 # ν”λ΅μ° μƒνƒ κ΄€λ¦¬ ν›…

lib/
β”β”€β”€ api/
β”‚   β””β”€β”€ follows.ts                # API ν΄λΌμ΄μ–ΈνΈ ν•¨μ
β””β”€β”€ types.ts                      # νƒ€μ… μ •μ (μμ •)
```

---

## π”„ ν™•μ¥ κ°€λ¥μ„±

### 1. ν–¥ν›„ ν™•μ¥ κΈ°λ¥
- ν”λ΅μ›/ν”λ΅μ‰ λ©λ΅ λ¨λ‹¬ (PRD 12μ¥μ—μ„ μ μ™Έλ¨)
- ν”λ΅μ° μ•λ¦Ό (μ μ™Έλ¨)
- μƒνΈ ν”λ΅μ° ν‘μ‹
- ν”λ΅μ° μ¶”μ² κΈ°λ¥

### 2. ν™•μ¥μ„ μ„ν• μ„¤κ³„
- λ¨λ“ν™”λ κµ¬μ΅°λ΅ κΈ°λ¥ μ¶”κ°€ μ©μ΄
- νƒ€μ… μ •μ ν™•μ¥ κ°€λ¥
- API μ—”λ“ν¬μΈνΈ ν™•μ¥ κ°€λ¥

---

## π“… κµ¬ν„ μμ„

### Step 1: κΈ°λ³Έ νƒ€μ… λ° API λΌμ°νΈ
1. νƒ€μ… μ •μ μ¶”κ°€ (`lib/types.ts`)
2. API λΌμ°νΈ κµ¬ν„ (`app/api/follows/route.ts`)
3. κΈ°λ³Έ ν…μ¤νΈ (μλ™)

### Step 2: API ν΄λΌμ΄μ–ΈνΈ λ° ν›…
4. API ν΄λΌμ΄μ–ΈνΈ λ¨λ“ (`lib/api/follows.ts`)
5. μ»¤μ¤ν…€ ν›… (`hooks/use-follow.ts`)
6. λ‹¨μ„ ν…μ¤νΈ

### Step 3: UI μ»΄ν¬λ„νΈ
7. ν”λ΅μ° λ²„νΌ μ»΄ν¬λ„νΈ (`components/profile/follow-button.tsx`)
8. μ¤νƒ€μΌλ§ λ° μ• λ‹λ©”μ΄μ…
9. μ ‘κ·Όμ„± κ°μ„ 

### Step 4: ν†µν•©
10. ν”„λ΅ν•„ νμ΄μ§€ ν†µν•©
11. μ—λ¬ μ²λ¦¬ λ° λ΅κΉ…
12. μµμΆ… ν…μ¤νΈ

---

## β… μ²΄ν¬λ¦¬μ¤νΈ

### Phase 1: νƒ€μ… μ •μ
- [ ] `UserWithFollowStatus` νƒ€μ… μ¶”κ°€
- [ ] `FollowResponse` νƒ€μ… μ¶”κ°€
- [ ] `FollowStatusResponse` νƒ€μ… μ¶”κ°€
- [ ] `FollowError` ν΄λμ¤ μ •μ

### Phase 2: API λΌμ°νΈ
- [ ] POST /api/follows κµ¬ν„
- [ ] DELETE /api/follows κµ¬ν„
- [ ] μ—λ¬ μ²λ¦¬ κµ¬ν„
- [ ] λ΅κΉ… μ¶”κ°€
- [ ] μλ™ ν…μ¤νΈ

### Phase 3: API ν΄λΌμ΄μ–ΈνΈ
- [ ] `followUser` ν•¨μ κµ¬ν„
- [ ] `unfollowUser` ν•¨μ κµ¬ν„
- [ ] `getFollowStatus` ν•¨μ κµ¬ν„ (μ„ νƒ)
- [ ] μ—λ¬ μ²λ¦¬

### Phase 4: μ»¤μ¤ν…€ ν›…
- [ ] `use-follow.ts` κµ¬ν„
- [ ] Optimistic UI λ΅μ§
- [ ] μ—λ¬ μ²λ¦¬
- [ ] ν…μ¤νΈ

### Phase 5: UI μ»΄ν¬λ„νΈ
- [ ] `FollowButton` μ»΄ν¬λ„νΈ κµ¬ν„
- [ ] μ¤νƒ€μΌλ§ (PRD μ»¬λ¬ μ¤ν‚¤λ§)
- [ ] Hover ν¨κ³Ό
- [ ] λ΅λ”© μƒνƒ
- [ ] μ ‘κ·Όμ„± κ°μ„ 

### Phase 6: ν†µν•©
- [ ] ν”„λ΅ν•„ ν—¤λ”μ— ν†µν•©
- [ ] ν”λ΅μ›/ν”λ΅μ‰ μ ν‘μ‹
- [ ] μµμΆ… ν…μ¤νΈ
- [ ] λ¬Έμ„ν™”

---

## π“ μ°Έκ³  μ‚¬ν•­

### κΈ°μ΅΄ μ½”λ“ ν¨ν„΄ μ¤€μ
- `app/api/posts/route.ts`μ μ—λ¬ μ²λ¦¬ ν¨ν„΄ μ°Έκ³ 
- `lib/supabase/server.ts`μ ν΄λΌμ΄μ–ΈνΈ μƒμ„± ν¨ν„΄ μ°Έκ³ 
- λ΅κΉ… ν•μ‹: `console.group`, `console.log`, `console.error`

### PRD μ¤€μ
- λ²„νΌ μ¤νƒ€μΌ: PRD 7.6 μ„Ήμ… μ°Έκ³ 
- μ»¬λ¬: PRD 6μ¥ μ°Έκ³ 
- λ°μ‘ν•: PRD 9μ¥ μ°Έκ³ 

### κ°λ° μ›μΉ™
- λ¨λ“ν™”: κ° λ μ΄μ–΄ λ¶„λ¦¬
- μ•μ •μ„±: μ² μ €ν• μ—λ¬ μ²λ¦¬
- ν™•μ¥μ„±: ν–¥ν›„ κΈ°λ¥ μ¶”κ°€ κ³ λ ¤
- μ„±λ¥: μµμ ν™”λ μΏΌλ¦¬ λ° UI μ—…λ°μ΄νΈ

---

**μ‘μ„±μΌ**: 2025-01-XX  
**μ‘μ„±μ**: AI Assistant  
**λ²„μ „**: 1.0



